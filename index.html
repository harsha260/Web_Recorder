<!DOCTYPE html>
<html>
<head>
    <title>Harsha_Web_Recorder - Screen Recorder</title>
    <style>
        body { background: #111; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        video { width: 80%; border: 2px solid #333; margin-top: 20px; border-radius: 8px; background: black; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; border: none; border-radius: 5px; margin: 10px; font-weight: bold; }
        #btnStart { background: #0f0; color: #000; }
        #btnStop { background: #f00; color: #fff; display: none; }
    </style>
</head>
<body>
    <h1>HARSHA WEB RECORDER</h1>
    <div>
        <button id="btnStart" onclick="startRecording()">Start Recording</button>
        <button id="btnStop" onclick="stopRecording()">Stop & Save</button>
    </div>
    <video id="preview" autoplay muted></video>

    <script>
        let mediaRecorder;
        let recordedChunks = [];

        async function startRecording() {
            try {
                // 1. Ask user for screen permission
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: { mediaSource: "screen" }, audio: true });
                
                // 2. Setup Recorder
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) recordedChunks.push(event.data);
                };
                
                // 3. Auto-save when user clicks "Stop Sharing" on the browser UI
                mediaRecorder.onstop = saveFile;

                // 4. Start
                mediaRecorder.start();
                document.getElementById('preview').srcObject = stream;
                document.getElementById('btnStart').style.display = 'none';
                document.getElementById('btnStop').style.display = 'inline-block';
            } catch (err) { console.error("Error: " + err); }
        }

        function stopRecording() {
            mediaRecorder.stop();
            let tracks = document.getElementById('preview').srcObject.getTracks();
            tracks.forEach(track => track.stop()); // Stop the camera/screen light
        }

        function saveFile() {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            a.download = "screen_recording_" + Date.now() + ".webm";
            document.body.appendChild(a);
            a.click();
            
            // Reset UI
            location.reload(); 
        }
    </script>
</body>
</html>
